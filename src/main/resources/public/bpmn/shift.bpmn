<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:camunda="http://camunda.org/schema/1.0/bpmn" id="Definitions_1" targetNamespace="platform" exporter="Camunda Modeler" exporterVersion="1.10.0">
  <bpmn:collaboration id="Collaboration_1kjx4nt">
    <bpmn:documentation>Store active session</bpmn:documentation>
    <bpmn:participant id="Participant_0mlpt32" name="Borders System" processRef="activate-shift" />
    <bpmn:participant id="Participant_00gisla" name="UI " />
    <bpmn:messageFlow id="MessageFlow_0mzbw92" name="Form submission" sourceRef="Participant_00gisla" targetRef="StartEvent_1" />
  </bpmn:collaboration>
  <bpmn:process id="activate-shift" name="Activate Shift" isExecutable="true">
    <bpmn:startEvent id="StartEvent_1" name="Shift start initiated">
      <bpmn:outgoing>SequenceFlow_08jcu12</bpmn:outgoing>
    </bpmn:startEvent>
    <bpmn:serviceTask id="Task_1f7bevv" name="Create shift record" camunda:type="external" camunda:topic="create-active-shift">
      <bpmn:incoming>SequenceFlow_1j57u59</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_0927hu5</bpmn:outgoing>
      <bpmn:dataOutputAssociation id="DataOutputAssociation_01356zx">
        <bpmn:targetRef>DataStoreReference_0qzm7dy</bpmn:targetRef>
      </bpmn:dataOutputAssociation>
    </bpmn:serviceTask>
    <bpmn:sequenceFlow id="SequenceFlow_0927hu5" sourceRef="Task_1f7bevv" targetRef="expireActiveSession">
      <bpmn:extensionElements>
        <camunda:executionListener event="take">
          <camunda:script scriptFormat="JavaScript"><![CDATA[print("Setting time data" + execution.getVariable('shiftInfo'));]]></camunda:script>
        </camunda:executionListener>
      </bpmn:extensionElements>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="SequenceFlow_1tivuep" sourceRef="expireActiveSession" targetRef="Task_0f5abt8" />
    <bpmn:sequenceFlow id="SequenceFlow_0d8vrvl" sourceRef="Task_0f5abt8" targetRef="EndEvent_0cjilnz" />
    <bpmn:sequenceFlow id="SequenceFlow_08jcu12" sourceRef="StartEvent_1" targetRef="ExclusiveGateway_00wv8pd" />
    <bpmn:exclusiveGateway id="ExclusiveGateway_00wv8pd" name="person exists?">
      <bpmn:incoming>SequenceFlow_08jcu12</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_1uwkwx0</bpmn:outgoing>
      <bpmn:outgoing>SequenceFlow_1fcbicp</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:sequenceFlow id="SequenceFlow_1uwkwx0" name="no" sourceRef="ExclusiveGateway_00wv8pd" targetRef="Task_0wzgaj7">
      <bpmn:extensionElements>
        <camunda:executionListener event="take">
          <camunda:script scriptFormat="javascript"><![CDATA[print("Person not found...moving to create person record..." + execution.getVariable('shiftInfo'));]]></camunda:script>
        </camunda:executionListener>
      </bpmn:extensionElements>
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression"><![CDATA[${shiftInfo.staffId == null || shiftInfo.staffId ==''}]]></bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="SequenceFlow_1fcbicp" name="yes" sourceRef="ExclusiveGateway_00wv8pd" targetRef="ExclusiveGateway_0uf1jgp">
      <bpmn:extensionElements>
        <camunda:executionListener event="take">
          <camunda:script scriptFormat="javascript"><![CDATA[print("Person found...moving to create active session" + execution.getVariable('shiftInfo'));]]></camunda:script>
        </camunda:executionListener>
      </bpmn:extensionElements>
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression"><![CDATA[${shiftInfo.staffId != null && shiftInfo.staffId !=''}]]></bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:serviceTask id="Task_0wzgaj7" name="Create user in store" camunda:type="external" camunda:topic="create-user-from-shift-info">
      <bpmn:incoming>SequenceFlow_1uwkwx0</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_0wrpwoe</bpmn:outgoing>
      <bpmn:dataOutputAssociation id="DataOutputAssociation_01t9kc3">
        <bpmn:targetRef>DataStoreReference_0qzm7dy</bpmn:targetRef>
      </bpmn:dataOutputAssociation>
    </bpmn:serviceTask>
    <bpmn:exclusiveGateway id="ExclusiveGateway_0uf1jgp">
      <bpmn:incoming>SequenceFlow_1fcbicp</bpmn:incoming>
      <bpmn:incoming>SequenceFlow_0wrpwoe</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_1j57u59</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:sequenceFlow id="SequenceFlow_1j57u59" sourceRef="ExclusiveGateway_0uf1jgp" targetRef="Task_1f7bevv" />
    <bpmn:sequenceFlow id="SequenceFlow_0wrpwoe" sourceRef="Task_0wzgaj7" targetRef="ExclusiveGateway_0uf1jgp" />
    <bpmn:dataStoreReference id="DataStoreReference_0qzm7dy" name="Persistent reference store" />
    <bpmn:intermediateCatchEvent id="expireActiveSession" name="Shift Expiry">
      <bpmn:incoming>SequenceFlow_0927hu5</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_1tivuep</bpmn:outgoing>
      <bpmn:timerEventDefinition>
        <bpmn:timeDate xsi:type="bpmn:tFormalExpression">${shiftInfo.endDateTime}</bpmn:timeDate>
      </bpmn:timerEventDefinition>
    </bpmn:intermediateCatchEvent>
    <bpmn:serviceTask id="Task_0f5abt8" name="Remove shift record" camunda:type="external" camunda:topic="remove-active-shift">
      <bpmn:incoming>SequenceFlow_1tivuep</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_0d8vrvl</bpmn:outgoing>
      <bpmn:dataOutputAssociation id="DataOutputAssociation_0fwhjkz">
        <bpmn:targetRef>DataStoreReference_0qzm7dy</bpmn:targetRef>
      </bpmn:dataOutputAssociation>
    </bpmn:serviceTask>
    <bpmn:endEvent id="EndEvent_0cjilnz" name="Active shift removed">
      <bpmn:incoming>SequenceFlow_0d8vrvl</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:textAnnotation id="TextAnnotation_03yyvyg">    <bpmn:text>Remove shift after specified time</bpmn:text>
</bpmn:textAnnotation>
    <bpmn:association id="Association_14dh0bf" sourceRef="expireActiveSession" targetRef="TextAnnotation_03yyvyg" />
  </bpmn:process>
  <bpmndi:BPMNDiagram id="BPMNDiagram_1">
    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="Collaboration_1kjx4nt">
      <bpmndi:BPMNShape id="Participant_0mlpt32_di" bpmnElement="Participant_0mlpt32">
        <dc:Bounds x="48" y="177" width="1186" height="429" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="_BPMNShape_StartEvent_2" bpmnElement="StartEvent_1">
        <dc:Bounds x="124" y="315" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="98" y="351" width="88" height="25" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Participant_1nvmvyi_di" bpmnElement="Participant_00gisla">
        <dc:Bounds x="48" y="-99" width="526" height="179" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="MessageFlow_0mzbw92_di" bpmnElement="MessageFlow_0mzbw92">
        <di:waypoint xsi:type="dc:Point" x="143" y="80" />
        <di:waypoint xsi:type="dc:Point" x="143" y="202" />
        <di:waypoint xsi:type="dc:Point" x="143" y="315" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="153" y="120.27586206896551" width="84" height="12" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="ServiceTask_0ukz2ic_di" bpmnElement="Task_1f7bevv">
        <dc:Bounds x="511" y="293" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_0927hu5_di" bpmnElement="SequenceFlow_0927hu5">
        <di:waypoint xsi:type="dc:Point" x="611" y="333" />
        <di:waypoint xsi:type="dc:Point" x="715" y="333" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="618" y="311.5" width="90" height="13" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="IntermediateCatchEvent_05hwa8g_di" bpmnElement="expireActiveSession">
        <dc:Bounds x="715" y="315" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="707" y="354" width="56" height="13" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="EndEvent_0cjilnz_di" bpmnElement="EndEvent_0cjilnz">
        <dc:Bounds x="1100" y="315" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1091" y="354" width="54" height="24" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="ServiceTask_018mejv_di" bpmnElement="Task_0f5abt8">
        <dc:Bounds x="853" y="293" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_1tivuep_di" bpmnElement="SequenceFlow_1tivuep">
        <di:waypoint xsi:type="dc:Point" x="751" y="333" />
        <di:waypoint xsi:type="dc:Point" x="804" y="333" />
        <di:waypoint xsi:type="dc:Point" x="804" y="333" />
        <di:waypoint xsi:type="dc:Point" x="853" y="333" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="774" y="326.5" width="90" height="13" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_0d8vrvl_di" bpmnElement="SequenceFlow_0d8vrvl">
        <di:waypoint xsi:type="dc:Point" x="953" y="333" />
        <di:waypoint xsi:type="dc:Point" x="1100" y="333" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="981.5" y="311.5" width="90" height="13" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="TextAnnotation_03yyvyg_di" bpmnElement="TextAnnotation_03yyvyg">
        <dc:Bounds x="619" y="231" width="100.00000000000001" height="53.55191256830601" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="Association_14dh0bf_di" bpmnElement="Association_14dh0bf">
        <di:waypoint xsi:type="dc:Point" x="722" y="320" />
        <di:waypoint xsi:type="dc:Point" x="692" y="285" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="DataStoreReference_0qzm7dy_di" bpmnElement="DataStoreReference_0qzm7dy">
        <dc:Bounds x="607.1311084624554" y="518.637663885578" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="595" y="561" width="74" height="25" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="DataOutputAssociation_01356zx_di" bpmnElement="DataOutputAssociation_01356zx">
        <di:waypoint xsi:type="dc:Point" x="561" y="373" />
        <di:waypoint xsi:type="dc:Point" x="561" y="550" />
        <di:waypoint xsi:type="dc:Point" x="607" y="550" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="DataOutputAssociation_0fwhjkz_di" bpmnElement="DataOutputAssociation_0fwhjkz">
        <di:waypoint xsi:type="dc:Point" x="903" y="373" />
        <di:waypoint xsi:type="dc:Point" x="903" y="542" />
        <di:waypoint xsi:type="dc:Point" x="657" y="542" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="ExclusiveGateway_00wv8pd_di" bpmnElement="ExclusiveGateway_00wv8pd" isMarkerVisible="true">
        <dc:Bounds x="211.1311084624553" y="308" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="200" y="282" width="71" height="13" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_08jcu12_di" bpmnElement="SequenceFlow_08jcu12">
        <di:waypoint xsi:type="dc:Point" x="160" y="333" />
        <di:waypoint xsi:type="dc:Point" x="211" y="333" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="185.5" y="311.5" width="0" height="13" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_1uwkwx0_di" bpmnElement="SequenceFlow_1uwkwx0">
        <di:waypoint xsi:type="dc:Point" x="236" y="358" />
        <di:waypoint xsi:type="dc:Point" x="236" y="478" />
        <di:waypoint xsi:type="dc:Point" x="272" y="478" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="245" y="411" width="13" height="13" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_1fcbicp_di" bpmnElement="SequenceFlow_1fcbicp">
        <di:waypoint xsi:type="dc:Point" x="261" y="333" />
        <di:waypoint xsi:type="dc:Point" x="414" y="333" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="328.5" y="311" width="18" height="13" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="ServiceTask_1izdytz_di" bpmnElement="Task_0wzgaj7">
        <dc:Bounds x="272" y="438" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="ExclusiveGateway_0uf1jgp_di" bpmnElement="ExclusiveGateway_0uf1jgp" isMarkerVisible="true">
        <dc:Bounds x="414.1311084624553" y="308" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="439.1311084624553" y="361" width="0" height="13" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_1j57u59_di" bpmnElement="SequenceFlow_1j57u59">
        <di:waypoint xsi:type="dc:Point" x="464" y="333" />
        <di:waypoint xsi:type="dc:Point" x="511" y="333" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="487.5" y="311" width="0" height="13" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_0wrpwoe_di" bpmnElement="SequenceFlow_0wrpwoe">
        <di:waypoint xsi:type="dc:Point" x="372" y="478" />
        <di:waypoint xsi:type="dc:Point" x="439" y="478" />
        <di:waypoint xsi:type="dc:Point" x="439" y="358" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="405.5" y="456" width="0" height="13" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="DataOutputAssociation_01t9kc3_di" bpmnElement="DataOutputAssociation_01t9kc3">
        <di:waypoint xsi:type="dc:Point" x="322" y="518" />
        <di:waypoint xsi:type="dc:Point" x="322" y="546" />
        <di:waypoint xsi:type="dc:Point" x="607" y="546" />
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</bpmn:definitions>
